\ This is a sort function entirely generated by AI servis from
\ https://chat.openai.com/chat
\ ../examples/Sort_by_AI.txt


\: sort ( adr n -- )
\   dup 0> abort" Niepoprawny rozmiar tablicy"
\   swap dup >r
\   begin
\       dup while
\       dup i @ over i @ < if
\           swap i @ over i !
\       then
\       1+
\   repeat
\   r> drop ;


\2000 CONSTANT N

\N	ARRAY	BUF

\ The call context can be as follows:
\ create buf 100 allot		allocate an array of 100 elems
\ buf				push the address of the first elem in buf
\ 25				push the num of elems to work with
\ 2dup				save for later
\ rand_fill
\ 2dup
\ show_all
\ 2dup
\ bubble_sort
\ 2dup
\ show_all


\ Fill the array given by addr with n odds
: rand_fill ( addr n -- )	
			0 do
				dup			\ addr addr
				rand   			\ addr addr r
				swap i cells + !	\ addr ( addr[ i ] = r )
			loop 
			drop				\ --
;



: show_all ( addr n -- )	
			0 do
				dup			\ addr addr
				i cells + ?	." ,"	\ addr
				i 1+ 10 mod 0= if cr then  \ ( CR each 10th line )

			loop
			drop				\ --
;




\ "addr" of a raw array of "n" cell-elements
: bubble_sort ( addr n -- )
	
	over			\ addr n addr

	begin
		
		over		\ addr n addr n
		1 swap 1	\ n 1		1 n		1 			n 1 
				\ 				exit flag for UNTIL	DO
		do
					\ addr n addr 1/0
			swap		\ addr n 1/0 addr
			dup dup		\ addr n 1/0 addr addr addr
			
			i cells + @	\ addr[ i ]
			swap		\ addr[ i ] addr
			i 1- cells + @	\ addr[ i ] addr[ i-1 ]
		
			2dup < if			\ addr n 1/0 addr addr[ i ] addr[ i-1 ]
				rot dup rot swap	\ addr n 1/0 addr[ i ] addr addr[ i-1 ] addr 
				i    cells + !		\ swap when writing to the array
				i 1- cells + !
				drop over 0		\ continue flag for UNTIL -- addr n 0
							\ addr n addr 0
			else
				drop drop swap		\ addr n addr 1/0
			then

		loop

		

	\ check condition here - if 0 then continue the loop, otherwise jump out (cond is removed from the stack)
	until

	2drop drop
;


